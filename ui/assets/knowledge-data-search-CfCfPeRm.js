import{y as k,r as l,j as e,s as S,B as C,d as D,S as R}from"./index-BkZ1fbvE.js";import{a as H}from"./search-C9nUSLrd.js";import{C as p,a as j,b as f,e as u}from"./card-CXEOfyPU.js";import{B as r}from"./badge-D8rsmH0n.js";import{S as M}from"./scroll-area-Bi1TlHFu.js";import{L as q}from"./loader-circle-qc_e4yNT.js";import{S as g}from"./search-CLI9qL7o.js";import{D as B}from"./database-Dw3Xe9Nb.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],N=k("file-text",E);function Q(){const[n,v]=l.useState(""),[d,b]=l.useState([]),[a,c]=l.useState(null),[i,m]=l.useState(!1),[o,x]=l.useState(null),h=async()=>{if(n.trim()){m(!0),x(null),c(null);try{const s={query:n.trim(),top_n:10,threshold:.7},t=await H(s);t?(b(t.results),t.results.length>0&&c(t.results[0])):x("搜索失败，请重试")}catch(s){x("搜索失败，请重试"),console.error(s)}finally{m(!1)}}},w=s=>{s.key==="Enter"&&h()},y=s=>e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Object.entries(s).map(([t,_])=>e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(r,{variant:"outline",className:"text-xs whitespace-nowrap shrink-0",children:t}),e.jsx("span",{className:"text-xs break-all flex-1",children:String(_)})]},t))});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{placeholder:"请输入搜索关键词",value:n,onChange:s=>v(s.target.value),onKeyDown:w,className:"flex-1"}),e.jsxs(C,{onClick:h,disabled:i||!n.trim(),className:"px-6",children:[i?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"搜索"})]})]}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:o})}),d.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[calc(100vh-200px)]",children:[e.jsxs("div",{className:"space-y-3 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2",children:[e.jsx(B,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold",children:"表格记录"}),e.jsxs(r,{variant:"secondary",children:[d.length," 条结果"]})]}),e.jsx("div",{className:"flex-1 h-full overflow-y-auto p-2",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:d.map((s,t)=>e.jsxs(p,{className:D("cursor-pointer transition-all hover:shadow-md",a?.table_data.knowledge_data_id===s.table_data.knowledge_data_id&&"ring-2 ring-primary"),onClick:()=>c(s),children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs(f,{className:"text-base font-medium",children:["记录 #",t+1]}),e.jsxs(r,{variant:s.table_data.score>.8?"default":"secondary",className:"text-xs",children:["相似度: ",s.table_data.score.toFixed(2)]})]})}),e.jsx(u,{className:"pt-0",children:y(s.table_data.row)})]},s.table_data.knowledge_data_id))})})]}),e.jsxs("div",{className:"space-y-3 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2",children:[e.jsx(N,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold",children:"知识库详情"}),a&&e.jsxs(r,{variant:"outline",children:["ID: ",a.knowledge_detail.knowledge_id]})]}),e.jsx(M,{className:"flex-1 pr-4",children:a?e.jsxs(p,{children:[e.jsx(j,{children:e.jsxs(f,{className:"text-base",children:["知识详情内容",a.knowledge_detail.version&&e.jsxs(r,{variant:"outline",className:"ml-2",children:["版本 ",a.knowledge_detail.version]})]})}),e.jsxs(u,{className:"space-y-4",children:[a.knowledge_detail.content?e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:a.knowledge_detail.content})}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"暂无知识详情内容"}),e.jsx(R,{}),a.knowledge_detail.reference&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"参考资料"}),e.jsx("a",{href:a.knowledge_detail.reference,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline break-all",children:a.knowledge_detail.reference})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"请选择左侧记录查看详情"})]})})})]})]}),!i&&d.length===0&&!o&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(g,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg mb-2",children:"开始搜索数据表格"}),e.jsx("p",{className:"text-sm",children:"输入关键词来搜索表格记录和知识库详情"})]})]})}export{Q as default};
