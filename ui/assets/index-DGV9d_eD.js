import{y as S,j as e,d as v,l as _,H as M,J as T,K as P,r as p,B as C,M as F,s as D,L as B}from"./index-BkZ1fbvE.js";import{M as O,R,a as A,S as L,C as E,b as z,c as U,P as $,d as H,e as G,f as q,g as J,h as V,i as K,j as Q}from"./prompt-input-BfJIM37A.js";import{D as W,a as X,b as Y,c as Z,d as ee,e as se}from"./dialog-DdHcYUWU.js";import{T as ae}from"./textarea-DrbJn6hG.js";import{L as I}from"./label-BPYBCH7t.js";import{s as te,u as ne}from"./feedback-D8cjZlZw.js";import"./vote-XaGOkas7.js";import"./popover-DRNDwRi0.js";import"./textarea-DZUYYOaG.js";import"./loader-circle-qc_e4yNT.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],re=S("upload",le),ie=({className:l,from:s,messageId:r,messageDbId:d,feedback:n,onFeedbackChange:c,onToggleChainOfThought:u,thoughtSteps:f,showChainOfThought:m=!1,hasChainOfThought:h=!1,chatStatus:o,isStreaming:g=!1,recommendQa:j,isLast:i=!1,sources:a,children:x,...t})=>e.jsxs("div",{className:v("group flex w-full items-start gap-2 py-4",s==="user"?"justify-end":"justify-start",l),...t,children:[s==="assistant"&&e.jsx(ce,{src:"./assets/12345.png",name:"AI助手"}),e.jsxs("div",{className:v("flex flex-col max-w-[90%] sm:max-w-[85%]",s==="user"&&"items-end"),children:[e.jsx("div",{className:v("rounded-lg inline-block w-full overflow-hidden",s==="user"?"bg-primary text-primary-foreground":"bg-secondary text-foreground"),children:i&&s==="assistant"&&o==="submitted"&&s==="assistant"&&o==="submitted"?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md bg-muted/50 border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-primary rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("span",{className:"inline-block w-2 h-2 bg-primary rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("span",{className:"inline-block w-2 h-2 bg-primary rounded-full animate-bounce"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"等待返回中..."})]}):x}),s==="assistant"&&r!==void 0&&(c||u)&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2 px-2 sm:px-3 py-2 rounded-md bg-muted/50 border border-border/50",children:e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground leading-relaxed break-words",children:"以上信息仅供参考，公积金政策解读及业务办理以现行政策和厦门市公积金机构最终审核结果为准，试运行期间，若有不明请至窗口或拨打12345人工服务。如遇访问链接无法打开情况，请复制链接地址到浏览器中打开。"})}),e.jsx(O,{messageId:r,feedback:n,onFeedbackChange:c,onToggleChainOfThought:u,showChainOfThought:m})]}),s==="assistant"&&g==!1&&i==!0&&j&&e.jsx(R,{questions:j})]})]}),oe=_("flex flex-col gap-1 overflow-hidden text-sm",{variants:{variant:{contained:[],flat:[]}},defaultVariants:{variant:"contained"}}),de=({children:l,className:s,variant:r,messageId:d,isUser:n=!1,sources:c,...u})=>e.jsx("div",{className:v("px-3 py-3 sm:px-4","overflow-x-hidden overflow-wrap-break-word break-words",oe({variant:r,className:s})),...u,children:typeof l=="string"?e.jsx(A,{messageId:d,content:l,isUser:n,sources:c}):l}),ce=({src:l,name:s,className:r,...d})=>e.jsxs(M,{className:v("size-8 ring-1 ring-border",r),...d,children:[e.jsx(T,{alt:"",className:"mt-0 mb-0",src:l}),e.jsx(P,{children:s?.slice(0,2)||"ME"})]}),me=({trigger:l,className:s})=>{const[r,d]=p.useState(!1),[n,c]=p.useState(""),[u,f]=p.useState(""),[m,h]=p.useState([]),[o,g]=p.useState(!1),j=t=>{const w=t.target.files;if(!w)return;const y=[];for(let N=0;N<w.length;N++){const b=w[N];if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(b.type)){alert(`不支持的文件类型: ${b.name}。支持的格式: JPEG, PNG, GIF, WebP`);continue}if(b.size>5*1024*1024){alert(`文件过大: ${b.name}。最大允许 5MB`);continue}const k=URL.createObjectURL(b);y.push({file:b,preview:k,id:Math.random().toString(36).substr(2,9)})}h(N=>[...N,...y].slice(0,5))},i=async()=>{const t=m.map(async w=>{const y=await ne(w.file);return{url:y.data.url,filename:"",size:0,content_type:"",path:y.data.url}});return Promise.all(t)},a=async()=>{if(!n.trim()){alert("请填写反馈内容");return}g(!0);try{let t=[];m.length>0&&(t=await i()),await te({content:n.trim(),phone:u.trim()||void 0,images:t.length>0?t:void 0}),c(""),f(""),h([]),d(!1)}catch(t){console.error("提交留言失败:",t)}finally{g(!1)}},x=()=>{m.forEach(t=>URL.revokeObjectURL(t.preview)),h([]),c(""),f(""),d(!1)};return e.jsxs(W,{open:r,onOpenChange:d,children:[e.jsx(X,{asChild:!0,children:l||e.jsxs(C,{variant:"outline",size:"sm",className:v("gap-2",s),children:[e.jsx(F,{className:"h-4 w-4"}),"留言反馈"]})}),e.jsxs(Y,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"留言反馈"}),e.jsx(se,{children:"说说你的问题"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"content",children:"反馈内容 *"}),e.jsx(ae,{id:"content",placeholder:"请详细描述您的问题或建议...",value:n,onChange:t=>c(t.target.value),className:"min-h-[120px]",maxLength:2e3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"phone",children:"联系电话"}),e.jsx(D,{id:"phone",placeholder:"请输入您的联系电话（选填）",value:u,onChange:t=>f(t.target.value)})]}),e.jsxs("div",{className:"space-y-2 hidden",children:[e.jsx(I,{children:"相关截图（选填，最多5张，每张不超过5MB）"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"image-upload",children:e.jsxs("div",{className:"inline-flex items-center gap-2 cursor-pointer",children:[e.jsx(C,{type:"button",variant:"outline",size:"sm",asChild:!0,disabled:m.length>=5,children:e.jsxs("span",{children:[e.jsx(re,{className:"h-4 w-4"}),"选择图片"]})}),e.jsx("input",{id:"image-upload",type:"file",multiple:!0,accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:j,className:"hidden",disabled:m.length>=5})]})}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m.length,"/5"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(C,{variant:"outline",onClick:x,disabled:o,children:"取消"}),e.jsx(C,{onClick:a,disabled:!n.trim()||o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"提交中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"提交留言"]})})]})]})]})};function pe(l){return l.replace(/<a href="([^"]+)">([^<]+)<\/a>/g,"[$2]($1)").replace(/\[来源: (?:\[doc_\d+\]\(doc_\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源: (?:\[graph_\d+\]\(graph_\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源: (?:\[data_\d+\]\(data_\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源:(?:\[doc_\d+\]\(doc_\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源: (?:\[data_\d+\]\(data_\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源:(?:\[data_\d+\]\(data_\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源:\s+doc_\d+\]/g,"").replace(/\[来源:\[doc_\d+\]\]/g,"").replace(/\[来源:\[graph_\d+\]\]/g,"").replace(/\[来源:\[data_\d+\]\]/g,"").replace(/\[来源:(?:\[\d+\]\(\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源: (?:\[\d+\]\(\d+\)(?:,\s*)?)+\]/g,"").replace(/来源: (?:\d+\(\d+\)(?:,\s*)?)+\]/g,"").replace(/\[来源:\[\d+\]\]/g,"").replace(/\n\n\*\*参考出处\*\*\n\n$/,"")}const Ce=()=>{const[l,s]=p.useState(""),{messages:r,sendMessage:d,status:n,stop:c,updateMessageFeedback:u,toggleChainOfThought:f,recommendQa:m}=B(),h=p.useRef(null),o=p.useRef(null),g=()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)};p.useEffect(()=>{g()},[]),p.useEffect(()=>{g()},[r]);const j=i=>{if(n==="streaming"||n==="submitted"){c();return}const a=!!i.text,x=!!i.files?.length;(a||x)&&(d(i.text||""),s(""))};return e.jsx("div",{className:"h-full flex flex-col min-h-0 w-full px-4 sm:px-5 lg:px-6 relative",children:e.jsxs("div",{ref:o,className:"absolute bg-background top-[1px] bottom-[115px] left-0 right-0 overflow-y-auto",children:[e.jsxs(E,{className:"flex-1 min-h-0 max-w-full sm:max-w-2xl lg:max-w-3xl mx-auto w-full",children:[e.jsx(z,{children:r.map(({content:i,...a},x)=>e.jsx(ie,{from:a.role,messageId:a.id,messageDbId:a.db_id,feedback:a.feedback,onFeedbackChange:u,onToggleChainOfThought:f,thoughtSteps:a.thoughtSteps,showChainOfThought:a.showChainOfThought,hasChainOfThought:a.hasChainOfThought,chatStatus:n,isStreaming:n==="streaming"&&a.role==="assistant",recommendQa:m,isLast:x===r.length-1,sources:a.sources,children:e.jsx(de,{messageId:a.id,isUser:a.role==="user",sources:a.sources,children:pe(i)})},a.id))}),e.jsx(U,{})]}),e.jsx("div",{className:"bg-background fixed left-0 right-0 bottom-0 w-full px-2 sm:px-4 z-20",children:e.jsxs("div",{className:"w-full max-w-full sm:max-w-2xl lg:max-w-3xl mx-auto",children:[e.jsxs($,{onSubmit:j,className:"mt-2",globalDrop:!0,multiple:!0,children:[e.jsx(H,{children:e.jsx(G,{onChange:i=>s(i.target.value),ref:h,value:l})}),e.jsxs(q,{children:[e.jsx(J,{children:e.jsx(V,{children:e.jsx(me,{})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{mode:"xfyun",onTranscriptionChange:s,textareaRef:h}),e.jsx(Q,{disabled:!l&&!n,status:n})]})]})]}),e.jsx("div",{className:"text-[9px] sm:text-[10px] text-gray-400 text-center mt-1 leading-tight px-2",children:"生成式人工智能声明：内容由AI生成，请甄别使用"})]})})]})})};export{Ce as default};
