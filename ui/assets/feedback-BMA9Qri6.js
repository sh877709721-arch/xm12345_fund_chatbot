import{r as i,t as B,j as e,d as D,s as P,B as x,a8 as L}from"./index-BkZ1fbvE.js";import{u as O,f as R,b as V,c as H,d as q,e as $}from"./index-BjZ7u3zq.js";import{B as G}from"./badge-D8rsmH0n.js";import{D as T,C as Y}from"./date-input-CPHms4xx.js";import{T as M,a as A,b as w,c as J,d as Q,e as k}from"./table-D5oD5D8Z.js";import{S as U,a as W,b as X,c as Z,d as ee}from"./select-BVe2FuYJ.js";import{g as ae,e as se}from"./feedback-D8cjZlZw.js";import{S as te}from"./search-CLI9qL7o.js";import{R as le,D as ne,C as oe,a as ie}from"./refresh-cw-Bc2JsiUX.js";import"./popover-DRNDwRi0.js";import"./index-BdQq_4o_.js";import"./index-JW4qzHJT.js";const E=()=>{const o=new Date;return new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0).toISOString()};function re(){const[o,r]=i.useState(!1),[s,h]=i.useState({items:[],total:0,page:1,size:10,has_next:!1,has_prev:!1}),[l,d]=i.useState({page:1,size:10,content:"",phone:"",start_date:E(),end_date:""}),m=i.useCallback(async()=>{r(!0);try{const n={page:l.page,size:l.size,content:l.content||void 0,phone:l.phone||void 0,start_date:l.start_date||void 0,end_date:l.end_date||void 0},t=await ae(n);return h({items:t.items,total:t.total,page:l.page,size:l.size,has_next:t.has_next,has_prev:t.has_prev}),t}catch(n){throw console.error("获取反馈数据失败:",n),B.error("获取反馈数据失败"),h({items:[],total:0,page:1,size:10,has_next:!1,has_prev:!1}),n}finally{r(!1)}},[l]),b=i.useCallback(n=>{d(t=>({...t,content:n.content!==void 0?n.content:t.content,phone:n.phone!==void 0?n.phone:t.phone,page:1}))},[]),C=i.useCallback(()=>{d({page:1,size:10,content:"",phone:"",start_date:E(),end_date:""})},[]),u=i.useCallback((n,t)=>{d(v=>({...v,start_date:n,end_date:t,page:1}))},[]),S=i.useCallback(n=>{d(t=>({...t,page:n}))},[]),z=i.useCallback(n=>{d(t=>({...t,page:1,size:n}))},[]),y=i.useCallback(()=>m(),[m]);i.useEffect(()=>{m()},[m]);const g=Math.ceil(s.total/s.size||1),f=s.has_next??s.page<g,j=s.has_prev??s.page>1;return{feedbackData:s,searchParams:l,loading:o,totalPages:g,hasNextPage:f,hasPrevPage:j,handleSearch:b,handleReset:C,handleDateRangeChange:u,handlePageChange:S,handlePageSizeChange:z,handleRefresh:y}}const F=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),ce=({content:o,maxLength:r=100})=>{const[s,h]=i.useState(!1);if(!o||o.trim()==="")return null;const l=o.length>r;if(!l)return e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:o});const d=s?o:o.slice(0,r)+"...";return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:d}),e.jsx("div",{className:"invisible group-hover:visible absolute z-50 max-w-md p-3 bg-popover border rounded-md shadow-lg",children:e.jsx("div",{className:"text-sm leading-relaxed whitespace-pre-wrap max-h-64 overflow-y-auto",children:o})}),l&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>h(!s),className:"mt-1 h-6 px-2 text-xs",children:s?"收起":"展开"})]})};function de({className:o}){const{feedbackData:r,searchParams:s,loading:h,totalPages:l,hasNextPage:d,hasPrevPage:m,handleSearch:b,handleReset:C,handleDateRangeChange:u,handlePageChange:S,handlePageSizeChange:z,handleRefresh:y}=re(),[g,f]=i.useState(s.content||""),[j,n]=i.useState(s.phone||"");i.useEffect(()=>{f(s.content||""),n(s.phone||"")},[s.content,s.phone]);const t=()=>{b({content:g,phone:j})},v=a=>{a.key==="Enter"&&(a.preventDefault(),t())},p=[{accessorKey:"id",header:"ID",cell:({row:a})=>e.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:a.original.id}),size:80,enableSorting:!0},{accessorKey:"content",header:"反馈内容",cell:({row:a})=>e.jsx("div",{className:"max-w-xl",children:e.jsx(ce,{content:a.original.content,maxLength:200})}),size:500,enableSorting:!1},{accessorKey:"phone",header:"手机号",cell:({row:a})=>e.jsx("span",{className:"text-sm text-muted-foreground",children:a.original.phone||"-"}),size:150,enableSorting:!1},{accessorKey:"status",header:"状态",cell:({row:a})=>e.jsx(G,{variant:"outline",children:a.original.status||"-"}),size:100,enableSorting:!1},{accessorKey:"created_time",header:"创建时间",cell:({row:a})=>e.jsx("span",{className:"text-sm text-muted-foreground",children:F(a.original.created_time)}),size:180,enableSorting:!0},{accessorKey:"updated_time",header:"更新时间",cell:({row:a})=>e.jsx("span",{className:"text-sm text-muted-foreground",children:F(a.original.updated_time)}),size:180,enableSorting:!0}],_=O({data:r.items,columns:p,enableRowSelection:!1,getCoreRowModel:$(),getFilteredRowModel:q(),getPaginationRowModel:H(),getSortedRowModel:V(),manualPagination:!0,manualSorting:!1,pageCount:l}),N=a=>{S(a)},I=a=>{z(Number(a))},K=async()=>{try{const a={content:s.content||void 0,phone:s.phone||void 0,start_date:s.start_date||void 0,end_date:s.end_date||void 0};await se(a)}catch(a){console.error("导出失败:",a)}};return e.jsxs("div",{className:D("w-full h-full flex flex-col",o),children:[e.jsx("div",{className:"py-2 flex-shrink-0",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(te,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(P,{placeholder:"请输入反馈内容",value:g,onChange:a=>{f(a.target.value)},onKeyDown:v,onBlur:t,className:"pl-8 h-8"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(P,{placeholder:"请输入手机号",value:j,onChange:a=>{n(a.target.value)},onKeyDown:v,onBlur:t,className:"h-8"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"开始时间："}),e.jsx(T,{value:s.start_date,onChange:a=>u(a||"",s.end_date),placeholder:"开始时间"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"结束时间："}),e.jsx(T,{value:s.end_date,onChange:a=>u(s.start_date,a||""),placeholder:"结束时间"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{onClick:y,disabled:h,className:"h-8",children:[e.jsx(le,{className:D("h-3 w-3 mr-1",h&&"animate-spin")}),"刷新"]}),e.jsx(x,{variant:"secondary",onClick:C,className:"h-8",children:"重置"}),e.jsxs(x,{onClick:K,disabled:h,variant:"outline",className:"h-8",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),"导出Excel"]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsxs("div",{className:"h-full rounded-lg border flex flex-col min-h-0",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(M,{className:"w-full table-fixed",children:[e.jsx("colgroup",{children:p.map((a,c)=>e.jsx("col",{style:{width:a.size}},c))}),e.jsx(A,{className:"bg-muted",children:_.getHeaderGroups().map(a=>e.jsx(w,{children:a.headers.map(c=>e.jsx(J,{colSpan:c.colSpan,className:"align-middle",children:c.isPlaceholder?null:R(c.column.columnDef.header,c.getContext())},c.id))},a.id))})]})}),e.jsx("div",{className:"overflow-auto flex-1",children:e.jsxs(M,{className:"w-full table-fixed",children:[e.jsx("colgroup",{children:p.map((a,c)=>e.jsx("col",{style:{width:a.size}},c))}),e.jsx(Q,{children:h?e.jsx(w,{children:e.jsx(k,{colSpan:p.length,className:"h-24 text-center",children:"加载中..."})}):_.getRowModel().rows.length?_.getRowModel().rows.map(a=>e.jsx(w,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(c=>e.jsx(k,{className:"align-middle py-2",children:R(c.column.columnDef.cell,c.getContext())},c.id))},a.id)):e.jsx(w,{children:e.jsx(k,{colSpan:p.length,className:"h-24 text-center",children:"无数据"})})})]})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-t flex-shrink-0",children:[e.jsxs("div",{className:"text-muted-foreground hidden flex-1 text-sm lg:flex",children:["共 ",r.total," 条数据"]}),e.jsxs("div",{className:"flex w-full items-center gap-8 lg:w-fit",children:[e.jsxs("div",{className:"hidden items-center gap-2 lg:flex",children:[e.jsx("span",{className:"text-sm font-medium",children:"每页行数"}),e.jsxs(U,{value:`${s.size}`,onValueChange:I,children:[e.jsx(W,{className:"w-20",size:"sm",children:e.jsx(X,{})}),e.jsx(Z,{side:"top",children:[10,20,30,40,50,100,500,1e3].map(a=>e.jsx(ee,{value:`${a}`,children:a},a))})]})]}),e.jsxs("div",{className:"text-sm font-medium",children:["第 ",r.page," 页，共 ",l," 页"]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 lg:ml-0",children:[e.jsx(x,{variant:"outline",className:"hidden lg:flex size-8",size:"icon",onClick:()=>N(1),disabled:r.page<=1,children:e.jsx(oe,{className:"size-4"})}),e.jsx(x,{variant:"outline",className:"size-8",size:"icon",onClick:()=>N(r.page-1),disabled:!m,children:e.jsx(Y,{className:"size-4"})}),e.jsx(x,{variant:"outline",className:"size-8",size:"icon",onClick:()=>N(r.page+1),disabled:!d,children:e.jsx(L,{className:"size-4"})}),e.jsx(x,{variant:"outline",className:"hidden lg:flex size-8",size:"icon",onClick:()=>N(l),disabled:!d||r.page>=l,children:e.jsx(ie,{className:"size-4"})})]})]})]})]})})]})}function Ce(){return e.jsx("div",{className:"flex gap-2 h-full",children:e.jsx("div",{className:"flex-1 flex flex-col p-6",children:e.jsx(de,{})})})}export{Ce as default};
